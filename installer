#!/bin/bash

# network driver
sudo dpkg -i /mnt/usb/medical-insight/1.network-driver/deb_files/*.deb
sudo sh /mnt/usb/medical-insight/1.network-driver/r8125-9.005.06/autorun.sh
device_name=$(ip addr | grep "2: enp" | awk '{print $2}')
echo -e "network: \
\n  version: 2 \
\n  ethernets: \
\n    $device_name \
\n      addresses: [192.168.0.214/24] \
\n      gateway4: 192.168.0.1 \
\n      nameservers: \
\n        addresses: [168.126.63.1,8.8.8.8] \
\n      dhcp4: no" > /etc/netplan/00-installer-config.yaml
sudo netplan apply
ip addr



# 의존성 문제 해결 : RTL8125 네트워크 드라이브 설치시 강제로 deb 파일들을 설치하여 조치함.
sudo apt-get update
sudo apt --fix-broken install -y
sudo apt-get update

# swap off
sudo swapon --show
sudo free -h
sudo swapoff -a
sudo rm -f /swap.img
checkval="/swap.img"
sudo sed -i 's/\/swap.img/\# \/swap.img/g' /etc/fstab
sudo swapon --show

# airuntime 계정 no passwd
sudo echo -e "\nairuntime\tALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# docker
sudo apt-get update
sudo apt-get remove docker docker-engine docker.io
sudo apt-get install docker.io apt-transport-https gnupg-agent -y
sudo adduser `id -un` docker

# install k9s, minikube, kubectl, istioctl
sudo install /mnt/usb/medical-insight/kubernetes/* /usr/local/bin/
